%%{init: {"theme":"base","flowchart":{"curve":"basis"},"themeVariables":{
  "fontFamily":"Inter, ui-sans-serif, system-ui",
  "primaryColor":"#e0f2fe",
  "primaryTextColor":"#0f172a",
  "primaryBorderColor":"#0284c7",
  "lineColor":"#334155",
  "tertiaryColor":"#f8fafc"
}}}%%

flowchart TB

%% ================= BOOKINFO =================
subgraph BOOKINFO["bookinfo namespace (data plane)"]
direction TB
classDef bookinfo fill:#dbeafe,stroke:#2563eb,stroke-width:2px;

sleep["sleep\n10.217.5.111:80"]
sleepEnvoy["envoy sidecar"]

product["productpage\n10.217.4.168:9080"]
productEnvoy["envoy sidecar"]

details["details\n10.217.4.241:9080"]
detailsEnvoy["envoy sidecar"]

reviews["reviews (v1|v2|v3)\n10.217.5.185:9080"]
reviewsEnvoy["envoy sidecar"]

ratings["ratings\n10.217.5.37:9080"]
ratingsEnvoy["envoy sidecar"]

class sleep,sleepEnvoy,product,productEnvoy,details,detailsEnvoy,reviews,reviewsEnvoy,ratings,ratingsEnvoy bookinfo;

sleep --> sleepEnvoy
sleepEnvoy --> productEnvoy
productEnvoy --> product

productEnvoy --> detailsEnvoy
detailsEnvoy --> details

productEnvoy --> reviewsEnvoy
reviewsEnvoy --> reviews

reviewsEnvoy --> ratingsEnvoy
ratingsEnvoy --> ratings
end

%% ================= ISTIO SYSTEM =================
subgraph ISTIO["istio-system namespace"]
direction TB
classDef istio fill:#ede9fe,stroke:#7c3aed,stroke-width:2px;

istiod["istiod\n10.217.5.24\n15010/15012/443/15014"]
otel["otel-collector\n10.217.5.112\n4317/4318"]
prom["prometheus\n10.217.4.193:9090"]
graf["grafana\n10.217.4.219:3000"]
kiali["kiali\n10.217.5.82\n20001/9090"]

class istiod,otel,prom,graf,kiali istio;
end

%% ================= TRACING =================
subgraph TRACING["tracing-system namespace"]
direction TB
classDef tracing fill:#dcfce7,stroke:#16a34a,stroke-width:2px;

tempo["tempo-tempo\n10.217.4.121\n3200/4317/4318"]
minio["minio\n10.217.4.226\n9000/9001"]

class tempo,minio tracing;
end

%% ================= FLOWS =================

%% xDS
istiod -.-> sleepEnvoy
istiod -.-> productEnvoy
istiod -.-> detailsEnvoy
istiod -.-> reviewsEnvoy
istiod -.-> ratingsEnvoy

%% OTLP
sleepEnvoy --> otel
productEnvoy --> otel
detailsEnvoy --> otel
reviewsEnvoy --> otel
ratingsEnvoy --> otel

otel --> tempo
tempo --> minio
tempo --> prom
prom --> graf
prom --> kiali

